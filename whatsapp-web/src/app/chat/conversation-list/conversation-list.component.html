<div class="search-container">
	<input
		type="text"
		placeholder="Filter conversations..."
		class="search-input"
		[ngModel]="searchQuery()"
		(ngModelChange)="onFilterQueryChange($event)"
		aria-label="Filter conversations"
	/>
	<!-- Optional: Clear button -->
	@if (searchQuery()) {
		<button class="clear-search-button" (click)="clearFilter()" aria-label="Clear filter">
			<!-- Updated method call -->
			&times;
		</button>
	}
</div>

<ul class="conversation-list">
	@for (conv of processedConversations(); track conv.id) {
		<li
			class="conversation-item"
			[class.selected]="conv.id === selectedId()"
			(click)="selectConversation(conv.id)"
		>
			<div class="avatar-placeholder">
				@if (conv.displayParticipant.profilePicture) {
					<img
						[src]="conv.displayParticipant.profilePicture"
						[alt]="conv.displayParticipant.name"
						title="conv.displayParticipant.name"
						class="avatar-image"
					/>
				} @else {
					<span>{{ conv.displayParticipant.initial || '?' }}</span>
				}
			</div>
			<div class="conversation-info">
				<span class="participant-name">
					{{ conv.displayParticipant.name || 'Uknown' }}
				</span>
				@if (conv.lastMessage?.content) {
					<p class="last-message">{{ conv.lastMessage?.content }}</p>
				} @else {
					<p class="last-message no-message">No messages yet</p>
				}
			</div>
			@if (conv.lastMessage?.sentAt) {
				<span class="timestamp">{{ formatTimestamp(conv.lastMessage?.sentAt) }}</span>
			}
		</li>
	} @empty {
		@if (searchQuery()) {
			<li class="no-conversations">No conversations match your filter.</li>
		} @else {
			<li class="no-conversations">No conversations found.</li>
		}
	}
</ul>
